<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Urban Alchemy üß™</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    color: white;
    background-color: #c8f7c5; /* light green fallback */
    background-size: cover;   /* cover entire viewport */
    background-position: center;
    background-repeat: no-repeat;
    transition: background-image 0.5s ease;
  }

  #topBar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 90%;
    padding: 10px 20px;
    background: rgba(0,0,0,0.6);
    border-radius: 10px;
    margin-top: 20px;
    z-index: 100;
  }

  button {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #4caf50;
    color: white;
    font-size: 14px;
    transition: transform 0.2s;
  }

  button:hover {
    transform: scale(1.05);
  }

  .scene {
    background: rgba(255, 255, 255, 0.0); /* fully transparent */
    border-radius: 12px;
    max-width: 700px;
    margin: 20px auto;
    padding: 20px;
    min-height: 400px;
    width: 100%;
  }

  .items-container {
    position: relative;
    border-radius: 15px;
    padding: 20px;
    width: 90vw;
    max-width: 1200px;
    height: 50vh;
    min-height: 400px;
    margin: 20px auto;
    background: rgba(255, 255, 255, 0.1); /* semi-transparent so bg shows through */
  }

  .items {
    position: relative;
    width: 100%;
    height: 80vh;
    border: 1px solid transparent;
  }

  .item {
    position: absolute;
    background: rgba(255,255,255,0.9);
    border: 2px solid #64b5f6;
    padding: 12px;
    border-radius: 10px;
    cursor: grab;
    width: 150px;
    text-align: center;
    font-size: 18px;
    transition: transform 0.2s, box-shadow 0.2s;
    user-select: none;
  }

  .item:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .item:active {
    cursor: grabbing;
  }

  .cauldrons {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 40px;
    padding: 0 50px;
    z-index: 50;
  }

  .cauldron {
    background: rgba(255,255,255,0.9);
    border: 3px dashed #ab47bc;
    padding: 20px;
    border-radius: 12px;
    width: 200px;
    font-size: 20px;
    pointer-events: all;
    transition: all 0.3s;
  }

  .cauldron:hover {
    background: rgba(255,255,255,1);
    transform: scale(1.05);
    border-color: #8e24aa;
  }

  .cauldron.drag-over {
    background: rgba(171, 71, 188, 0.3);
    border-style: solid;
    box-shadow: 0 0 20px rgba(171, 71, 188, 0.8);
  }

  /* HOME SCREEN */
  #homeScreen {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    background: linear-gradient(135deg, #c8f7c5, #a8e6a3);
    color: #000;
  }

  #homeScreen h1 {
    font-size: 3em;
    margin-bottom: 20px;
  }

  #homeScreen button {
    font-size: 18px;
    padding: 15px 40px;
  }

  /* Wizard Modal */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .modal-content {
    background: white;
    color: black;
    padding: 30px;
    border-radius: 14px;
    max-width: 450px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }

  #score {
    background: rgba(0,0,0,0.6);
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
  }
</style>
</head>

<body>

<!-- HOME SCREEN -->
<div id="homeScreen">
  <h1>üß™ Urban Alchemy</h1>
  <p>You are a wizard restoring Georgia cities through sustainability magic.</p>
  <button onclick="startGame()">Start Game</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" style="display:none;">
  <div id="topBar">
    <h2 id="levelTitle"></h2>
    <button onclick="resetGame()">üè† Home</button>
  </div>

  <p id="score">‚ú® Sustainability Power: 0</p>

  <div class="scene" id="scene">
    <h3 style="background: rgba(0,0,0,0.6); display: inline-block; padding: 10px 20px; border-radius: 8px;">üß∫ Items to Sort</h3>
    <div class="items-container" id="itemsContainer"></div>
  </div>

  <div class="cauldrons">
    <div class="cauldron" data-choice="recycle">‚ôªÔ∏è Recycle</div>
    <div class="cauldron" data-choice="compost">üå± Compost</div>
  </div>
</div>

<!-- WIZARD POPUP -->
<div class="modal" id="wizardModal">
  <div class="modal-content">
    <h3>üßô‚Äç‚ôÇÔ∏è Wizard of Sustainability</h3>
    <p id="wizardText"></p>
    <button onclick="closeWizard()">Continue</button>
  </div>
</div>

<script>
/* ---------------- GAME DATA ---------------- */
const levels = [
  {
    name: 'üìç Atlanta',
    bgImage: 'atlanta.jgp',
    items: [
      { emoji: 'ü•§', name: 'Plastic Bottle', category: 'recycle' },
      { emoji: 'üì∞', name: 'Newspaper', category: 'recycle' },
      { emoji: 'üçå', name: 'Banana Peel', category: 'compost' },
      { emoji: 'üì±', name: 'Old Phone', category: 'recycle' },
      { emoji: 'üì¶', name: 'Cardboard Box', category: 'recycle' }
    ]
  },
  {
    name: 'üìç Savannah',
    bgImage: 'savannah.jpg',
    items: [
      { emoji: 'ü•´', name: 'Aluminum Can', category: 'recycle' },
      { emoji: 'üçÉ', name: 'Leaves', category: 'compost' },
      { emoji: 'üêö', name: 'Seaweed', category: 'compost' },
      { emoji: 'ü™Æ', name: 'Old Comb', category: 'recycle' },
      { emoji: 'ü•ï', name: 'Carrot Scraps', category: 'compost' },
      { emoji: 'üõ¢Ô∏è', name: 'Oil Can', category: 'recycle' }
    ]
  },
  {
    name: 'üìç Athens',
    bgImage: 'athens.jpg',
    items: [
      { emoji: 'üçé', name: 'Apple Core', category: 'compost' },
      { emoji: 'ü•™', name: 'Sandwich Wrapper', category: 'recycle' },
      { emoji: '‚òï', name: 'Coffee Cup', category: 'recycle' },
      { emoji: 'üßÄ', name: 'Cheese Rind', category: 'compost' },
      { emoji: 'üìù', name: 'Notebook', category: 'recycle' },
      { emoji: 'üçï', name: 'Pizza Box', category: 'recycle' },
      { emoji: 'ü•õ', name: 'Milk Carton', category: 'recycle' }
    ]
  }
];

let currentLevel = 0;
let score = 0;
let remainingItems = [];
let draggedItem = null;

/* ---------------- GAME FLOW ---------------- */
function startGame() {
  document.getElementById("homeScreen").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";
  score = 0;
  currentLevel = 0;
  loadLevel();
}

function resetGame() {
  document.getElementById("gameScreen").style.display = "none";
  document.getElementById("homeScreen").style.display = "block";
  document.body.style.backgroundImage = "";
}

/* ---------------- LOAD LEVEL ---------------- */
function loadLevel() {
  const level = levels[currentLevel];
  document.getElementById("levelTitle").innerText = level.name;
  document.getElementById("score").innerText = "‚ú® Sustainability Power: " + score;

  // Set body background image (full screen background)
  document.body.style.backgroundImage = `url('${level.bgImage}')`;
  document.body.style.backgroundSize = 'cover';
  document.body.style.backgroundPosition = 'center';
  document.body.style.backgroundRepeat = 'no-repeat';

  remainingItems = shuffle([...level.items]);
  renderItems();
}

/* ---------------- RENDER ITEMS WITH RANDOM POSITIONING (NO OVERLAP) ---------------- */
function renderItems() {
  const container = document.getElementById("itemsContainer");
  container.innerHTML = "";

  // Ensure container has position relative
  container.style.position = "relative";

  // Track placed item positions to avoid overlap
  const placedItems = [];

  remainingItems.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "item";
    div.draggable = true;
    div.dataset.itemName = item.name;
    div.dataset.category = item.category;
    div.innerText = `${item.emoji} ${item.name}`;

    // Add to DOM first
    container.appendChild(div);

    // Then position randomly after a tiny delay to ensure container has dimensions
    setTimeout(() => {
      const containerWidth = container.clientWidth;
      const containerHeight = container.clientHeight;
      
      // Item dimensions
      const itemWidth = 150;
      const itemHeight = 60;
      const padding = 15; // Space between items
      
      // Calculate safe boundaries
      const maxX = Math.max(0, containerWidth - itemWidth - 20);
      const maxY = Math.max(0, containerHeight - itemHeight - 20);
      
      // Find non-overlapping position
      let x, y, attempts = 0, maxAttempts = 100;
      let overlapping = true;
      
      while (overlapping && attempts < maxAttempts) {
        x = Math.random() * maxX;
        y = Math.random() * maxY;
        
        // Check if this position overlaps with any placed item
        overlapping = placedItems.some(placed => {
          return !(x + itemWidth + padding < placed.x ||
                   x > placed.x + placed.width + padding ||
                   y + itemHeight + padding < placed.y ||
                   y > placed.y + placed.height + padding);
        });
        
        attempts++;
      }
      
      // If we couldn't find a spot after max attempts, place it anyway (fallback)
      div.style.left = x + "px";
      div.style.top = y + "px";
      
      // Record this item's position
      placedItems.push({
        x: x,
        y: y,
        width: itemWidth,
        height: itemHeight
      });
      
    }, index * 50); // Stagger slightly for visual effect

    // Drag event
    div.addEventListener("dragstart", () => {
      draggedItem = item;
      div.style.opacity = "0.5";
    });

    div.addEventListener("dragend", () => {
      div.style.opacity = "1";
    });
  });
}

/* ---------------- DRAG & DROP ---------------- */
document.querySelectorAll(".cauldron").forEach(cauldron => {
  cauldron.addEventListener("dragover", e => {
    e.preventDefault();
    cauldron.classList.add("drag-over");
  });

  cauldron.addEventListener("dragleave", () => {
    cauldron.classList.remove("drag-over");
  });

  cauldron.addEventListener("drop", (e) => {
    e.preventDefault();
    cauldron.classList.remove("drag-over");
    const choice = cauldron.dataset.choice;
    judgeMove(draggedItem, choice);
  });
});

/* ---------------- AI WIZARD FEEDBACK ---------------- */
function judgeMove(item, choice) {
  if (!item) return;

  const correct = item.category === choice;
  let points = correct ? 20 : 5;
  score += points;

  remainingItems = remainingItems.filter(i => i !== item);

  const message = correct
    ? `‚ú® Excellent transmutation!\n\nBy placing the ${item.name} into the ${choice} cauldron, you used sustainability magic correctly. (+${points} points)`
    : `‚ö†Ô∏è A learning moment!\n\nThe ${item.name} should go into the ${item.category} cauldron instead. But every effort counts! (+${points} points)`;

  document.getElementById("wizardText").innerText = message;
  document.getElementById("wizardModal").style.display = "flex";
  document.getElementById("score").innerText = "‚ú® Sustainability Power: " + score;
}

function closeWizard() {
  document.getElementById("wizardModal").style.display = "none";

  if (remainingItems.length === 0) {
    currentLevel++;
    if (currentLevel < levels.length) {
      setTimeout(() => loadLevel(), 300);
    } else {
      alert("üéâ You completed all levels! Final Score: " + score + "\nYou are a Sustainability Master!");
      resetGame();
    }
  } else {
    renderItems();
  }
}

/* ---------------- UTILS ---------------- */
function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

</script>

</body>
</html>
